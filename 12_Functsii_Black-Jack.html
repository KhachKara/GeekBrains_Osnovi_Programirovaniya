<meta charset="utf-8">
<script type="text/javascript">

var arrKarti = 			['2','3','4','5','6','7','8','9','10','J','Q','K','A'];			//Эталон Карты
var arrKartiNumber = 	['2','3','4','5','6','7','8','9','10','10','10','10','11'];		//Временные карты

var Deposit = 100;						// Депозит 
var	Stavka = 0;							// Стоимость одной ставки
var Viigrish = 0						// Выиигрыш
var Eshe = '0';							//Условия выхода из игры

alert("УРОК 12 ФУНКЦИИ" + "\n" + "\n" + "Игра BLACK JACK" + "\n" + "\n" + "Достоинства карт." + "\n" + "2 - 2" + "\n" + "3 - 3" + "\n" + "4 - 4" + "\n" + "5 - 5" + "\n" + "6 - 6" + "\n" + "7 - 7" + "\n" + "8 - 8" + "\n" + "9 - 9" + "\n" + "10 - 10" + "\n" + "J - 10" + "\n" + "Q - 10" + "\n" + "K - 10" + "\n" + "A - 11");

//функция для генерации случайных чисел в заданном диапазоне min, max
function SluchaynoeChislo(min, max){
	return Math.floor(Math.random() * (max - min + 1)) + min;
}

//функция для генерации случайных карт
function RazdachaKart(){
	return (arrKarti[SluchaynoeChislo(0,arrKarti.length-1)]);
};


// функция для подсчета суммы карт
function SummNumber(arrSomebodyKarti){
	var Summa = 0;
	for(var i = 0; i < arrSomebodyKarti.length; i++)
	{
		if(arrSomebodyKarti[i] == 'J' || arrSomebodyKarti[i] == 'Q' || arrSomebodyKarti[i] == 'K'){
			Summa = Summa + 10;
		}else if(arrSomebodyKarti[i] == 'A') {
			Summa = Summa + 11;
		}else {
			Summa = Summa + parseInt(arrSomebodyKarti[i]);
		}
	}
	return Summa;
}

// функция подсчета вероятности проигрыша
function VeroyatnostViigrisha (SummNumber){
	var Raznitsa = 0;
	var stop;
	Raznitsa = 21 - SummNumber;
	if(Raznitsa >= 11)
		return 100;
	if(Raznitsa < 2)
		return 0;
	for(var i = 0; i < arrKartiNumber.length; i++)
	{
		if(Raznitsa == arrKartiNumber[i])
		{
			stop = i+1;	 //i+1 количество выигрышных исходов из возможных 13-и спросить у Мгера
			break;
		}
	}
	return (100 - ((13 - stop)/13*100)).toFixed(2);
}  

//-----------------------------------------------------------------------------------

//Основной цикл (тело игры в Black Jack)
do{


	var Stop = '0';			//переменная для выхода из цикла
	var SummaIgrok = 0;			//Сумма карт
	var SummaDealer = 0;
	var arrIgrok = [];						// Карты игрока	
	var arrDealer = [];						// Карты дилера

	//выдача двух карт играку на начало игры
	arrIgrok.push(RazdachaKart());
	arrIgrok.push(RazdachaKart());

	
	//считает сумму достоинств выпавшых карт
	SummaIgrok = SummNumber(arrIgrok);


	//цикл где игрок решает нужно ли ему брать добавочную карту или нет
	do{
		Eshe = prompt("Ваши карты: " + arrIgrok + "\n" + "\n" + " Сумма карт: " + SummaIgrok + "\n" + "\n" + "Желаете еще карту?" + "\n" + "\n" + "Если да вводите '0' , если нет 'ENTER'" + "\n" + "\n" + "ВНИМАННИЕ!!!" + "\n" + "\n" + "Вероятность выигрыша, если взять еще одну карту, будет равна: " + VeroyatnostViigrisha(parseInt(SummaIgrok)) + "%");
		
		if(Eshe == '0'){
			arrIgrok.push(RazdachaKart());
			SummaIgrok = SummNumber(arrIgrok);			
			if(SummaIgrok > 21){
				alert("УПС!" + "\n" + "ПЕРЕБОР!" + "\n" + "Добавленная карта: " + arrIgrok[arrIgrok.length-1] + "\n" + "\n" + "Ваши карты: " + arrIgrok + "\n" + "\n" + "Вы проиграли!" + "\n" + "Сумма: " + SummaIgrok);
				break;
					}
			}else{			
				alert("Ваши карты: " + arrIgrok + "\n" + "Сумма: " + SummaIgrok);
			};
	}while(Eshe == '0')
	if(SummaIgrok > 21)
	{
		continue;
	}

//---------------------- Диллерская Часть -------------------------------------- 
	
	//выдача двух карт играку на начало игры
	arrDealer.push(RazdachaKart());
	arrDealer.push(RazdachaKart());
	
	//считает сумму достоинств выпавшых карт
	SummaDealer = SummNumber(arrDealer);
	
	while (SummaDealer < SummaIgrok) {
		arrDealer.push(RazdachaKart());
		SummaDealer = SummNumber(arrDealer);
	}

	// случай при ничье
	if(arrDealer == SummaIgrok){
		alert("НИЧЬЯ!");
	}
	
	alert("Ваши карты: " + arrIgrok + "\n" + SummaIgrok + "\n" + "\n" + "Карты диллера: " + arrDealer  + "\n" + SummaDealer);


Stop = prompt("Хотите завершить игру?" + "\n" + "Вводите '0' в поле с низу");
} while (Stop != '0')

//					▲▲▲▲▲▲▲▲▲▲▲▲▲ Исправно работает ▲▲▲▲▲▲▲
//-------------------------------------------------------------------------------------------------
//					▼▼▼▼▼▼▼▼▼▼▼▼▼ Дальше не доделано ▼▼▼▼▼▼
</script>

